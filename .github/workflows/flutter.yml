#The workflow is triggered on push to a branch named release/flutter-app-* and on pull request to the production branch. The first job builds the APK and uploads it as an artifact. The second job downloads the artifact and deploys it to Firebase App Distribution.

name: Flutter

on:
  push:
    branches: [ "release/flutter-app-*" ]
  pull_request:
    branches: [ "production" ]

jobs:
  build:

    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: mealdash_flutter_app
      
    steps:
    - uses: actions/checkout@v2
    - uses: subosito/flutter-action@v1
      with:
        channel: 'stable'
    - name: Install dependencies
      run: flutter pub get
    # - name: Format code
    #   run: flutter format --set-exit-if-changed .
    - name: Build APK
      run: flutter build apk --release
    - name: Upload APK
      uses: actions/upload-artifact@v2
      with:
        name: app-release.apk
        path: ./flutter-app/build/app/outputs/flutter-apk/app-release.apk
      
  # deploy:
  #   needs: build
  #   runs-on: ubuntu-latest
  #   steps:
  #   - uses: actions/checkout@v2
  #   - name: Download APK
  #     uses: actions/download-artifact@v2
  #     with:
  #       name: app-release.apk
  #   - name: Deploy to Firebase
  #     uses: wzieba/Firebase-Distribution-Github-Action@v1
  #     with:
  #       appId: ${{ secrets.FIREBASE_APP_ID }}
  #       token: ${{ secrets.FIREBASE_TOKEN }}
  #       groups: testers
  #       file: app-release.apk


